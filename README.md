- [Overview](#overview)
- [MDM End Users](#mdm-end-users)
    - [Top Level Menu Items](#top-level-menu-items)
    - [Magento commands](#magento-commands)
    - [Top Level Menu Items](#top-level-menu-items-1)
    - [PWA](#pwa)
    - [Top Level Menu Items](#top-level-menu-items-2)
    - [Help / Support](#help--support)
    - [Useful resources](#useful-resources)
    - [Logs](#logs)
    - [Maintenance](#maintenance)
    - [Top Level Menu Items](#top-level-menu-items-3)
  - [Frequently Asked Qestions (FAQ)](#frequently-asked-qestions-faq)
    - ["How do I spoof domains?" or "Why is my certificate invalid?"](#how-do-i-spoof-domains-or-why-is-my-certificate-invalid)
    - ["What is the default admin username and password?"](#what-is-the-default-admin-username-and-password)
    - ["How do I setup and where do I place my auth.json file?"](#how-do-i-setup-and-where-do-i-place-my-authjson-file)
    - ["What's auth.json used for?"](#whats-authjson-used-for)
    - ["What does this error mean?"](#what-does-this-error-mean)
- [MDM Developers](#mdm-developers)
  - [Configuration](#configuration)
    - [Configuration of MDM](#configuration-of-mdm)
    - [Configuration of an MDM app](#configuration-of-an-mdm-app)
  - [Development on a Mac](#development-on-a-mac)
    - [1. clone this repo](#1-clone-this-repo)
    - [2. configure additional features](#2-configure-additional-features)
    - [3. set up your env](#3-set-up-your-env)
  - [Additional troubleshooting notes](#additional-troubleshooting-notes)
  - [Development on Linux](#development-on-linux)
    - [1. add the default user to the docker group](#1-add-the-default-user-to-the-docker-group)
    - [2. clone this repo](#2-clone-this-repo)

# Overview

Screenshots of the MDM UI on a Mac (left) and on any terminal - Mac/Linux/Windows (right).

| OSX Menu App | CLI Menu App
|:-:|:-:|
|<img src="imgs/osx-menu.png"> |<img src="imgs/cli-menu.png">|

Magento Docker Manager (MDM) is a cross platform (Mac/Linux/Windows) application to run multiple, simultaneous Magento
applications on your local system via Docker. Once installed, simply select options from the available menu items to
manage your applications.

MDM's menus are **contextual**. Only applicable options are shown. For example, if a tool is not installed, you will
be prompted to install it before continuing to unlock a feature. If the application is stopped, you'll be prompted it
to start it for additional options.

MDM has 2 general audiences: 
1. End users who might use the Magento app for demos, testing/QA, or training 
2. Developers who want to develop/test locally on a Magento Cloud like env or want to configure a packaged app for
their team of end users

# MDM End Users

End users experience MDM almost entirely through the contextual menus. Below is every possible menu item *(in the order
they would appear)* with some additional notes if appropiate. If you do not see a particular menu item, then MDM 
determined it's not currently appropiate. Many items only become available after toggling **Advanced** mode on.

<!--- START AUTOGENERATED MD by markdown-generator-for-menu-items.sh --->

### Top Level Menu Items 

|Top Level Menu Items|   |   |
|:---|:-:|:--|
|âš ï¸â–¶ï¸ Docker not installed. Click for download. |[link]($docker_install_link)|Complete the install by running Docker for the 1st time to reveal more menu items.|
|â–¶ï¸ Finish Docker install by running for the 1st time.|   |Finish the install by running Docker for the 1st time and revealing more menu items.|
|ğŸ”¼ Install added tools for more features|   |Highly recommended - includes the magento-cloud CLI, mkcert, tmate, platypus, docker CLI completion|
|ğŸš Adjust Docker for min reqs|   |Update the docker vm settings for better performance.|
|â–¶ï¸ Start Docker to continue|   |Docker is not running. Start it.|
|âš ï¸ Missing credentials - features limited|   |MDM can not find your `~/.composer/auth.json` file. You won't be able to create new apps from source or use features tied to your GitHub org configuration, but a prepackaged app will work. The link to doc shows how to create it.|
|âš ï¸ Credentials found but invalid |[link](https://devdocs.magento.com/guides/v2.4/install-gde/prereq/dev_install.html#instgde-prereq-compose-clone-auth)|Your `~/.composer/auth.json` file exists, but the JSON contents aren't parsing correctly OR it doesn't have the required GitHub token & Magento keys. Please verify its contents.|
|ğŸ”„ Update MDM|   |There is a new version of MDM available. Under *Maintenance*, there is an option to revert if needed.|
|ğŸ”¼ Install & open Magento app|   |   |
|âš ï¸ğŸ”¼ Can't install - ports in use.|   |Some local service other than docker is using port 80 or 443.|
|ğŸš€ Open https://$(get_hostname_for_this_app)|   |Opens your browser to the app's base url. The menu will render the base url instead of the function call. You'll actually see something like: 'ğŸš€ Open https://mysite.com'|
|ğŸ›‘ Stop Magento app|   |If not actively being using, stopping the app will free memory.|
|â–¶ï¸ Restart Magento app|   |   |
|âš ï¸â–¶ï¸ Can't restart app - ports in use.|   |   |
|ğŸš¨ Uninstall this Magento app|   |If an error occurred during install, this option allows you to try again.|
|ğŸ›‘ Stop all other Magento apps|   |While multiple Magento apps can run at the same time, it may consume many resources.|
|ğŸ“¦ Create a new Magento app|   |Asks for a Magento Cloud project to recreate locally|
|<nobr>â€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒ</nobr>|<nobr>â€ƒâ€ƒâ€ƒ</nobr>|â€ƒâ€ƒâ€ƒ|

<!--- # start Magento commands submenu --->
### Magento commands 

|Magento commands|   |   |
|:---|:-:|:--|
|ğŸ›‘ App stopped. Many cmds N/A|   |Start Magento to reveal more options|
|ğŸ’» Start shell in app|   |   |
|Reindex|   |   |
|Run cron jobs|   |   |
|Enable all except cms cache|   |   |
|Enable all caches|   |   |
|Flush cache|   |   |
|Warm cache|   |   |
|Pre-generate resized catalog images|   |   |
|Change url for app|   |Use ANY url for your app. Combine with certificate spoofing for better browser compatibility.|
|ğŸ’» Start MDM shell|   |*Advanced* See the status of your Docker services|
|<nobr>â€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒ</nobr>|<nobr>â€ƒâ€ƒâ€ƒ</nobr>|â€ƒâ€ƒâ€ƒ|
<!--- # end Magento commands submenu --->

### Top Level Menu Items 

|Top Level Menu Items|   |   |
|:---|:-:|:--|
|ğŸ“ Show MDM logs|   |*Advanced* Watch the MDM output in realtime. Combine with MDM debugging under *Maintenance*|
|<nobr>â€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒ</nobr>|<nobr>â€ƒâ€ƒâ€ƒ</nobr>|â€ƒâ€ƒâ€ƒ|

<!--- # start PWA submenu --->
### PWA 

|PWA|   |   |
|:---|:-:|:--|
|(Re)start PWA using this Magento app|   |The PWA will use the local Magento app as the backend.|
|ğŸ›‘ App stopped. Start PWA offline|   |   |
|(Re)start PWA using a remote backend|   |   |
|Storystore PWA @ GitHub |[link](https://github.com/PMET-public/storystore-pwa/blob/master/README.md)|   |
|<nobr>â€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒ</nobr>|<nobr>â€ƒâ€ƒâ€ƒ</nobr>|â€ƒâ€ƒâ€ƒ|
<!--- # end PWA submenu --->

### Top Level Menu Items 

|Top Level Menu Items|   |   |
|:---|:-:|:--|
|âš ï¸ Can't run PWA - ports in use.|   |A local service is already using the required ports.|
|<nobr>â€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒ</nobr>|<nobr>â€ƒâ€ƒâ€ƒ</nobr>|â€ƒâ€ƒâ€ƒ|

<!--- # start Help / Support submenu --->
### Help / Support 

|Help / Support|   |   |
|:---|:-:|:--|
|Magento Org #m2-demo-support |[link](slack://channel?team=T016XBMUQLA&id=C018FCG0HHS)|link to slack channel|
|ğŸ’» Grant remote access to system|   |Only remote users with pre-authorized keys will be able to connect *1* time. If not configured, a warning appears. Choose if you want to continue and provide the secret url to a remote user.|
|ğŸ›‘ Stop remote system access|   |   |
|ğŸ”“ Grant remote web access|   |If configured, creates a public url able to access this Magenot app.|
|ğŸ›‘ Stop remote web access; revert url|   |   |
|Magento Community #cloud-docker |[link](slack://channel?team=T4YUW69CM&id=CJ6F3F8NS)|link to slack channel|
|Offical Cloud Support |[link](https://support.magento.com/hc/en-us/requests)|   |
|<nobr>â€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒ</nobr>|<nobr>â€ƒâ€ƒâ€ƒ</nobr>|â€ƒâ€ƒâ€ƒ|
<!--- # end Help/Support submenu --->


<!--- # start Useful resources submenu --->
### Useful resources 

|Useful resources|   |   |
|:---|:-:|:--|
|MDM @ GitHub |[link](https://github.com/pmet-public/mdm)|This project|
|Docker Folder (OneDrive) |[link](https://adobe.sharepoint.com/sites/SITeam/Shared%20Documents/adobe-internal/docker)|   |
|SI Team Home Page (SharePoint) |[link](https://adobe.sharepoint.com/sites/SITeam/SitePages/home.aspx)|   |
|Docker development @ devdocs |[link](https://devdocs.magento.com/cloud/docker/docker-development.html)|The project that MDM builds on to mimic Magento Cloud services|
|Your Magento Cloud Projects |[link](https://demo.magento.cloud/projects/)|   |
|Magento Cloud Chrome Extension |[link](https://github.com/PMET-public/magento-cloud-extension)|   |
|Inside Adobe |[link](https://inside.corp.adobe.com/)|   |
|Field Readiness |[link](https://fieldreadiness-adobe.highspot.com/spots/5cba1d07659e93677419f707)|   |
|<nobr>â€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒ</nobr>|<nobr>â€ƒâ€ƒâ€ƒ</nobr>|â€ƒâ€ƒâ€ƒ|
<!--- # end Useful resources submenu --->


<!--- # start logs submenu --->
### Logs 

|Logs|   |*Advanced*|
|:---|:-:|:--|
|Show errors from MDM log|   |Show just the recorded errors|
|Show entire MDM log|   |   |
|Show Magento app logs|   |   |
|<nobr>â€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒ</nobr>|<nobr>â€ƒâ€ƒâ€ƒ</nobr>|â€ƒâ€ƒâ€ƒ|
<!--- # end logs submenu --->


<!--- # start maintenance submenu --->
### Maintenance 

|Maintenance|   |*Advanced*|
|:---|:-:|:--|
|ğŸ PHP Xdebug is ON\|OFF for this app|   |Turn on|off php debugging|
|ğŸ MDM debugging is ON\|OFF for this app|   |Turn on|off debugging of MDM - much more info written to the logs|
|Force check for new MDM version|   |   |
|Revert to previous MDM|   |   |
|âš ï¸  ğŸ”“ Permit spoofing ANY domain is ON\|OFF!|   |Create TLS certificates that are valid *locally* for any domain. Do not share your local CA!|
|ğŸ”„ Reload reverse proxy|   |   |
|ğŸ§¹ Remove hosts added to /etc/hosts|   |   |
|ğŸ§¹ Prune all unused docker images|   |Removes old or currently unused Docker images. If no apps are currently installed, Docker will re-download the required images during installation.|
|âš ï¸  Prune all non-running containers and volumes|   |Deletes ANY installation that is not ACTIVELY RUNNING. This will remove any installation that you can not currently browse.|
|âš ï¸  Prune everything EXCEPT images|   |This will delete ALL docker containers, volumes, and networks. ONLY Docker images will be preserved to avoid re-downloading images for new installations.|
|ğŸš¨ Wipe Docker (removes ALL Docker artifacts)|   |Use this to wipe the Docker virtual machine of all data. Only modified Docker VM settings will be preserved.|
|<nobr>â€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒ</nobr>|<nobr>â€ƒâ€ƒâ€ƒ</nobr>|â€ƒâ€ƒâ€ƒ|
<!--- # end maintenance submenu --->

### Top Level Menu Items 

|Top Level Menu Items|   |   |
|:---|:-:|:--|
|ğŸ’¡Advanced mode is ON\|OFF         (v. $v)|   |Show more advanced menu items and display the current version of MDM|
|<nobr>â€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒ</nobr>|<nobr>â€ƒâ€ƒâ€ƒ</nobr>|â€ƒâ€ƒâ€ƒ|
<!--- END AUTOGENERATED MD by markdown-generator-for-menu-items.sh --->


## Frequently Asked Qestions (FAQ)

### "How do I spoof domains?" or "Why is my certificate invalid?"

By default, the option to "spoof" (mimic) any domain is disabled. You should not enable it on a computer that you share or allow others access, too. If a malicious user gains access to your system, they might use it to spoof legitimate domains. With that caveat, it's still very useful. To enable it, enable advance mode, then go to the maintenance menu, then toggle the spoofing option on.

### "What is the default admin username and password?"

The values are inherited from the Magento Cloud Docker project [here](https://github.com/magento/magento-cloud-docker/blob/bc964b272b6c40e2b1b2c8832ef56d40182cbd99/src/Config/Dist/Generator.php#L183)

### "How do I setup and where do I place my auth.json file?"

Follow the instructions [here](https://devdocs.magento.com/guides/v2.4/install-gde/prereq/dev_install.html#instgde-prereq-compose-clone-auth) with 1 clarification: place your `auth.json` file in your `~/.composer/` so the full, explicit path will be something like `/Users/yourusername/.composer/auth.json` on OSX or `/home/yourusername/.composer/auth.json` on Linux systems.

### "What's auth.json used for?"

You may have downloaded or received a pre-bundled app with all the required modules, but if you need/want to run `composer update` to get future updates OR you want to create your own app, you will need an `auth.json` file. Also the GitHub token in the `auth.json` file is used to configure/download additional features of MDM (e.g. valid wildcard TLS certificates, web tunneling, etc.)

### "What does this error mean?"

Whichever error you encounter, please check (i.e. search) to see if your [issue](https://github.com/PMET-public/mdm/issues?q=is%3Aissue) has already been reported and possibly solved. If not, please open a new one.

---

# MDM Developers

## Configuration

### Configuration of MDM
|Feature|Config Param|
|-|---|
| Public Certs |`mdm_domain`|
| |`mdm_domain_fullchain_gh_url`|
| |`mdm_domain_privkey_gh_url`|
| | |
| Remote Support/Access |`mdm_tmate_authorized_keys_url`|
| | |
| Public Web Access|`mdm_tunnel_domain`|
| |`mdm_tunnel_ssh_url`|
| |`mdm_tunnel_pk_url`|

### Configuration of an MDM app




## Development on a Mac

### 1. clone this repo

```
$ git clone https://github.com/PMET-public/mdm.git && cd mdm
```

### 2. configure additional features

```
cp .mdm_config.tmpl.sh .mdm_config.sh
```

### 3. set up your env

```
$ export debug=1 MDM_REPO_DIR=. COMPOSER_AUTH='{"github-oauth":{"github.com":"..."}}'
```

## Additional troubleshooting notes

To debug the launching script, `export debug_launcher=1`, too. This is currently a separate var because the launching script debugging output would otherwise pollute the menu output before the logging initialization can run. Also, it represents the output of the app's `<osx_appp>/Contents/Resources/script`, not the output of ~/.mdm/current/launcher because it is bundled with the app.  The launcher should not need to be debugged often because it's relatively minimal, stable code to bootstrap the app.

## Development on Linux

Since the included Travis CI and GitHub Workflow configuration use Ubuntu Bionic (18.04) for testing, you will probably also want a local version for faster feedback and debugging.

You can use the default included Vagrantfile. Remember to install the vagrant-diskzie plugin first.

```
$ vagrant plugin install vagrant-disksize
$ vagrant up
$ vagrant ssh
```

In your test vm, there's are just a few remaining setup steps.

### 1. add the default user to the docker group

```
$ sudo apt update && sudo apt upgrade -y
$ sudo apt install docker-compose php -y
$ sudo usermod -aG docker vagrant
$ sudo shutdown -r now
```

### 2. clone this repo

